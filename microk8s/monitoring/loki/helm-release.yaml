# apiVersion: helm.toolkit.fluxcd.io/v2beta1
# kind: HelmRelease
# metadata:
#   name: loki
#   namespace: monitoring
# spec:
#   interval: 5m
#   chart:
#     spec:
#       chart: loki
#       version: 5.41.4
#       sourceRef:
#         kind: HelmRepository
#         name: grafana
#         namespace: monitoring
#         # namespace: flux-system
#   values:
#     isDefault: true
#     loki:
#       persistence:
#         enabled: true
#         size: 10Gi

apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: loki
  namespace: monitoring
spec:
  interval: 5m
  chart:
    spec:
      chart: loki
      version: 5.41.4
      sourceRef:
        kind: HelmRepository
        name: grafana
        namespace: monitoring
  values:
    mode: 'singleBinary'
    loki:
      auth_enabled: false
      commonConfig:
        replication_factor: 1
      storage:
        type: filesystem
      compactor:
        retention_enabled: true
    gateway:
      enabled: false # Disable if not needed
    read:
      replicas: 1
    write:
      replicas: 1
    backend:
      replicas: 1
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 500m
        memory: 512Mi
    persistence:
      enabled: true
      size: 5Gi
      storageClass: standard
